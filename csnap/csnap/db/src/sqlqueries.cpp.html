<!DOCTYPE html>
<html><head><title>C:/projects/csnap/db/src/sqlqueries.cpp</title><link id="codestylesheet" rel="stylesheet" type="text/css" href="../../../syntax.qtcreator.css"/><link rel="stylesheet" type="text/css" href="../../../tooltip.css"/><script type="text/javascript">var csnapRootPath="../../../";</script><script type="text/javascript" src="../../../codenav.js"> </script></head><body><div id="content"><h2>Code</h2><table class="code" file-id="22"><tbody><tr><th id="L1">1</th><td><i>// Copyright (C) 2023 Vincent Chambrin</i></td></tr><tr><th id="L2">2</th><td><i>// This file is part of the 'csnap' project.</i></td></tr><tr><th id="L3">3</th><td><i>// For conditions of distribution and use, see copyright notice in LICENSE.</i></td></tr><tr><th id="L4">4</th><td/></tr><tr><th id="L5">5</th><td><u>#include</u> <a class="include" href="../include/csnap/database/sqlqueries.h.html"><span class="include">"sqlqueries.h"</span></a></td></tr><tr><th id="L6">6</th><td/></tr><tr><th id="L7">7</th><td><u>#include</u> <a class="include" href="../include/csnap/database/snapshot.h.html"><span class="include">"snapshot.h"</span></a></td></tr><tr><th id="L8">8</th><td><u>#include</u> <a class="include" href="../include/csnap/database/sql.h.html"><span class="include">"sql.h"</span></a></td></tr><tr><th id="L9">9</th><td/></tr><tr><th id="L10">10</th><td><u>#include</u> <a class="include" href="../../model/include/csnap/model/file.h.html"><span class="include">"csnap/model/file.h"</span></a></td></tr><tr><th id="L11">11</th><td><u>#include</u> <a class="include" href="../../model/include/csnap/model/include.h.html"><span class="include">"csnap/model/include.h"</span></a></td></tr><tr><th id="L12">12</th><td><u>#include</u> <a class="include" href="../../model/include/csnap/model/reference.h.html"><span class="include">"csnap/model/reference.h"</span></a></td></tr><tr><th id="L13">13</th><td><u>#include</u> <a class="include" href="../../model/include/csnap/model/symbol.h.html"><span class="include">"csnap/model/symbol.h"</span></a></td></tr><tr><th id="L14">14</th><td><u>#include</u> <a class="include" href="../../model/include/csnap/model/translationunit.h.html"><span class="include">"csnap/model/translationunit.h"</span></a></td></tr><tr><th id="L15">15</th><td/></tr><tr><th id="L16">16</th><td><u>#include</u> <span class="include">&lt;algorithm&gt;</span></td></tr><tr><th id="L17">17</th><td><u>#include</u> <span class="include">&lt;numeric&gt;</span></td></tr><tr><th id="L18">18</th><td/></tr><tr><th id="L19">19</th><td><b>namespace</b> <dfn class="namespace" sym-ref="4505.csnap">csnap</dfn></td></tr><tr><th id="L20">20</th><td>{</td></tr><tr><th id="L21">21</th><td/></tr><tr><th id="L22">22</th><td><b>static</b> <em>const</em> <em>char</em>* <dfn class="variable" sym-ref="4871.SQL_CREATE_STATEMENTS">SQL_CREATE_STATEMENTS</dfn> = R"(</td></tr><tr><th id="L23">23</th><td>BEGIN TRANSACTION;</td></tr><tr><th id="L24">24</th><td/></tr><tr><th id="L25">25</th><td>CREATE TABLE IF NOT EXISTS <var>"info"</var> (</td></tr><tr><th id="L26">26</th><td>  <var>"id"</var> INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</td></tr><tr><th id="L27">27</th><td>  <var>"key"</var> TEXT NOT NULL,</td></tr><tr><th id="L28">28</th><td>  <var>"value"</var> TEXT NOT NULL</td></tr><tr><th id="L29">29</th><td>);</td></tr><tr><th id="L30">30</th><td/></tr><tr><th id="L31">31</th><td>CREATE TABLE IF NOT EXISTS <var>"file"</var> (</td></tr><tr><th id="L32">32</th><td>  <var>"id"</var>      INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</td></tr><tr><th id="L33">33</th><td>  <var>"path"</var>    TEXT NOT NULL,</td></tr><tr><th id="L34">34</th><td>  <var>"content"</var> TEXT</td></tr><tr><th id="L35">35</th><td>);</td></tr><tr><th id="L36">36</th><td/></tr><tr><th id="L37">37</th><td>CREATE TABLE <var>"compileoptions"</var> (</td></tr><tr><th id="L38">38</th><td>  <var>"id"</var>          INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</td></tr><tr><th id="L39">39</th><td>  <var>"defines"</var>     TEXT NOT NULL,</td></tr><tr><th id="L40">40</th><td>  <var>"includedirs"</var> TEXT NOT NULL</td></tr><tr><th id="L41">41</th><td>);</td></tr><tr><th id="L42">42</th><td/></tr><tr><th id="L43">43</th><td>CREATE TABLE IF NOT EXISTS <var>"translationunit"</var> (</td></tr><tr><th id="L44">44</th><td>  <var>"id"</var>                             INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</td></tr><tr><th id="L45">45</th><td>  <var>"file_id"</var>                        INTEGER NOT NULL,</td></tr><tr><th id="L46">46</th><td>  <var>"compileoptions_id"</var>              INTEGER,</td></tr><tr><th id="L47">47</th><td>  <var>"ast"</var>                            BLOB,</td></tr><tr><th id="L48">48</th><td>  FOREIGN KEY(<var>"file_id"</var>)           REFERENCES <var>"file"</var>(<var>"id"</var>),</td></tr><tr><th id="L49">49</th><td>  FOREIGN KEY(<var>"compileoptions_id"</var>) REFERENCES <var>"compileoptions"</var>(<var>"id"</var>)</td></tr><tr><th id="L50">50</th><td>);</td></tr><tr><th id="L51">51</th><td/></tr><tr><th id="L52">52</th><td>CREATE TABLE <var>"ppinclude"</var> (</td></tr><tr><th id="L53">53</th><td>  <var>"translationunit_id"</var>              INTEGER NOT NULL,</td></tr><tr><th id="L54">54</th><td>  <var>"file_id"</var>                         INTEGER NOT NULL,</td></tr><tr><th id="L55">55</th><td>  <var>"line"</var>                            INTEGER NOT NULL,</td></tr><tr><th id="L56">56</th><td>  <var>"included_file_id"</var>                INTEGER NOT NULL,</td></tr><tr><th id="L57">57</th><td>  FOREIGN KEY(<var>"translationunit_id"</var>) REFERENCES <var>"translationunit"</var>(<var>"id"</var>),</td></tr><tr><th id="L58">58</th><td>  FOREIGN KEY(<var>"file_id"</var>)            REFERENCES <var>"file"</var>(<var>"id"</var>),</td></tr><tr><th id="L59">59</th><td>  FOREIGN KEY(<var>"included_file_id"</var>)   REFERENCES <var>"file"</var>(<var>"id"</var>)</td></tr><tr><th id="L60">60</th><td>);</td></tr><tr><th id="L61">61</th><td/></tr><tr><th id="L62">62</th><td>CREATE TABLE <var>"include"</var> (</td></tr><tr><th id="L63">63</th><td>  <var>"file_id"</var>                       INTEGER NOT NULL,</td></tr><tr><th id="L64">64</th><td>  <var>"line"</var>                          INTEGER NOT NULL,</td></tr><tr><th id="L65">65</th><td>  <var>"included_file_id"</var>              INTEGER NOT NULL,</td></tr><tr><th id="L66">66</th><td>  FOREIGN KEY(<var>"file_id"</var>)          REFERENCES <var>"file"</var>(<var>"id"</var>),</td></tr><tr><th id="L67">67</th><td>  FOREIGN KEY(<var>"included_file_id"</var>) REFERENCES <var>"file"</var>(<var>"id"</var>),</td></tr><tr><th id="L68">68</th><td>  UNIQUE(file_id, line)</td></tr><tr><th id="L69">69</th><td>);</td></tr><tr><th id="L70">70</th><td/></tr><tr><th id="L71">71</th><td>CREATE TABLE IF NOT EXISTS <var>"symwhatsit"</var> (</td></tr><tr><th id="L72">72</th><td>  <var>"id"</var>   INTEGER NOT NULL PRIMARY KEY UNIQUE,</td></tr><tr><th id="L73">73</th><td>  <var>"name"</var> TEXT NOT NULL</td></tr><tr><th id="L74">74</th><td>);</td></tr><tr><th id="L75">75</th><td/></tr><tr><th id="L76">76</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>0</var>, <var>"Unexposed"</var>);</td></tr><tr><th id="L77">77</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>1</var>, <var>"Typedef"</var>);</td></tr><tr><th id="L78">78</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>2</var>, <var>"Function"</var>);</td></tr><tr><th id="L79">79</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>3</var>, <var>"Variable"</var>);</td></tr><tr><th id="L80">80</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>4</var>, <var>"Field"</var>);</td></tr><tr><th id="L81">81</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>5</var>, <var>"EnumConstant"</var>);</td></tr><tr><th id="L82">82</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>6</var>, <var>"ObjCClass"</var>);</td></tr><tr><th id="L83">83</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>7</var>, <var>"ObjCProtocol"</var>);</td></tr><tr><th id="L84">84</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>8</var>, <var>"ObjCCategory"</var>);</td></tr><tr><th id="L85">85</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>9</var>, <var>"ObjCInstanceMethod"</var>);</td></tr><tr><th id="L86">86</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>10</var>, <var>"ObjCClassMethod"</var>);</td></tr><tr><th id="L87">87</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>11</var>, <var>"ObjCProperty"</var>);</td></tr><tr><th id="L88">88</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>12</var>, <var>"ObjCIvar"</var>);</td></tr><tr><th id="L89">89</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>13</var>, <var>"Enum"</var>);</td></tr><tr><th id="L90">90</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>14</var>, <var>"Struct"</var>);</td></tr><tr><th id="L91">91</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>15</var>, <var>"Union"</var>);</td></tr><tr><th id="L92">92</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>16</var>, <var>"CXXClass"</var>);</td></tr><tr><th id="L93">93</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>17</var>, <var>"CXXNamespace"</var>);</td></tr><tr><th id="L94">94</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>18</var>, <var>"CXXNamespaceAlias"</var>);</td></tr><tr><th id="L95">95</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>19</var>, <var>"CXXStaticVariable"</var>);</td></tr><tr><th id="L96">96</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>20</var>, <var>"CXXStaticMethod"</var>);</td></tr><tr><th id="L97">97</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>21</var>, <var>"CXXInstanceMethod"</var>);</td></tr><tr><th id="L98">98</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>22</var>, <var>"CXXConstructor"</var>);</td></tr><tr><th id="L99">99</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>23</var>, <var>"CXXDestructor"</var>);</td></tr><tr><th id="L100">100</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>24</var>, <var>"CXXConversionFunction"</var>);</td></tr><tr><th id="L101">101</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>25</var>, <var>"CXXTypeAlias"</var>);</td></tr><tr><th id="L102">102</th><td>INSERT INTO symwhatsit (id, name) VALUES(<var>26</var>, <var>"CXXInterface"</var>);</td></tr><tr><th id="L103">103</th><td/></tr><tr><th id="L104">104</th><td>CREATE TABLE IF NOT EXISTS <var>"symbol"</var> (</td></tr><tr><th id="L105">105</th><td>  <var>"id"</var>                INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE,</td></tr><tr><th id="L106">106</th><td>  <var>"what"</var>              INTEGER NOT NULL,</td></tr><tr><th id="L107">107</th><td>  <var>"parent"</var>            INTEGER,</td></tr><tr><th id="L108">108</th><td>  <var>"name"</var>              TEXT NOT NULL,</td></tr><tr><th id="L109">109</th><td>  <var>"usr"</var>               TEXT NOT NULL,</td></tr><tr><th id="L110">110</th><td>  <var>"displayname"</var>       TEXT,</td></tr><tr><th id="L111">111</th><td>  <var>"flags"</var>             INTEGER NOT NULL DEFAULT <var>0</var>,</td></tr><tr><th id="L112">112</th><td>  FOREIGN KEY(<var>"what"</var>) REFERENCES <var>"symwhatsit"</var>(<var>"id"</var>)</td></tr><tr><th id="L113">113</th><td>);</td></tr><tr><th id="L114">114</th><td/></tr><tr><th id="L115">115</th><td>CREATE TABLE IF NOT EXISTS <var>"symbolreference"</var> (</td></tr><tr><th id="L116">116</th><td>  <var>"symbol_id"</var>                     INTEGER NOT NULL,</td></tr><tr><th id="L117">117</th><td>  <var>"file_id"</var>                       INTEGER NOT NULL,</td></tr><tr><th id="L118">118</th><td>  <var>"line"</var>                          INTEGER NOT NULL,</td></tr><tr><th id="L119">119</th><td>  <var>"col"</var>                           INTEGER NOT NULL,</td></tr><tr><th id="L120">120</th><td>  <var>"parent_symbol_id"</var>              INTEGER,</td></tr><tr><th id="L121">121</th><td>  <var>"flags"</var>                         INTEGER NOT NULL DEFAULT <var>0</var>,</td></tr><tr><th id="L122">122</th><td>  FOREIGN KEY(<var>"symbol_id"</var>)        REFERENCES <var>"symbol"</var>(<var>"id"</var>),</td></tr><tr><th id="L123">123</th><td>  FOREIGN KEY(<var>"file_id"</var>)          REFERENCES <var>"file"</var>(<var>"id"</var>),</td></tr><tr><th id="L124">124</th><td>  FOREIGN KEY(<var>"parent_symbol_id"</var>) REFERENCES <var>"symbol"</var>(<var>"id"</var>)</td></tr><tr><th id="L125">125</th><td>);</td></tr><tr><th id="L126">126</th><td/></tr><tr><th id="L127">127</th><td>CREATE TABLE IF NOT EXISTS <var>"base"</var> (</td></tr><tr><th id="L128">128</th><td>  <var>"symbol_id"</var>              INTEGER NOT NULL,</td></tr><tr><th id="L129">129</th><td>  <var>"base_id"</var>                INTEGER NOT NULL,</td></tr><tr><th id="L130">130</th><td>  <var>"access_specifier"</var>       INTEGER NOT NULL,</td></tr><tr><th id="L131">131</th><td>  FOREIGN KEY(<var>"symbol_id"</var>) REFERENCES <var>"symbol"</var>(<var>"id"</var>),</td></tr><tr><th id="L132">132</th><td>  FOREIGN KEY(<var>"base_id"</var>)   REFERENCES <var>"symbol"</var>(<var>"id"</var>)</td></tr><tr><th id="L133">133</th><td/></tr><tr><th id="L134">134</th><td>);</td></tr><tr><th id="L135">135</th><td/></tr><tr><th id="L136">136</th><td>CREATE VIEW symboldefinition (symbol_id, file_id, line, col, flags) AS</td></tr><tr><th id="L137">137</th><td>  SELECT symbol_id, file_id, line, col, flags</td></tr><tr><th id="L138">138</th><td>  FROM symbolreference WHERE flags &amp; <var>2</var>;</td></tr><tr><th id="L139">139</th><td/></tr><tr><th id="L140">140</th><td>COMMIT;</td></tr><tr><th id="L141">141</th><td>)";</td></tr><tr><th id="L142">142</th><td/></tr><tr><th id="L143">143</th><td><b>template</b>&lt;<b>typename</b> T, <b>typename</b> F&gt;</td></tr><tr><th id="L144">144</th><td>std::vector&lt;T&gt; <dfn class="fn" sym-ref="4872.read_vector">read_vector</dfn>(sql::Statement&amp; stmt, F&amp;&amp; func)</td></tr><tr><th id="L145">145</th><td>{</td></tr><tr><th id="L146">146</th><td>  std::vector&lt;T&gt; r;</td></tr><tr><th id="L147">147</th><td/></tr><tr><th id="L148">148</th><td>  <b>while</b> (stmt.step())</td></tr><tr><th id="L149">149</th><td>  {</td></tr><tr><th id="L150">150</th><td>    r.push_back(func(stmt));</td></tr><tr><th id="L151">151</th><td>  }</td></tr><tr><th id="L152">152</th><td/></tr><tr><th id="L153">153</th><td>  <b>return</b> r;</td></tr><tr><th id="L154">154</th><td>}</td></tr><tr><th id="L155">155</th><td/></tr><tr><th id="L156">156</th><td><em>const</em> <em>char</em>* <dfn class="fn" sym-ref="4799.db_init_statements">db_init_statements</dfn>()</td></tr><tr><th id="L157">157</th><td>{</td></tr><tr><th id="L158">158</th><td>  <b>return</b> <a href="sqlqueries.cpp.html#L22" class="variable" sym-ref="4871.SQL_CREATE_STATEMENTS">SQL_CREATE_STATEMENTS</a>;</td></tr><tr><th id="L159">159</th><td>}</td></tr><tr><th id="L160">160</th><td/></tr><tr><th id="L161">161</th><td><em>void</em> <dfn class="fn" sym-ref="4800.insert_info">insert_info</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <em>const</em> <a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span>&amp; key, <em>const</em> <a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span>&amp; value)</td></tr><tr><th id="L162">162</th><td>{</td></tr><tr><th id="L163">163</th><td>  sqlite3_stmt* stmt = <b>nullptr</b>;</td></tr><tr><th id="L164">164</th><td/></tr><tr><th id="L165">165</th><td>  sqlite3_prepare_v2(db.sqliteHandle(),</td></tr><tr><th id="L166">166</th><td>    <var>"INSERT OR REPLACE INTO info (key, value) VALUES (?,?)"</var>,</td></tr><tr><th id="L167">167</th><td>    -<var>1</var>, &amp;stmt, <b>nullptr</b>);</td></tr><tr><th id="L168">168</th><td/></tr><tr><th id="L169">169</th><td>  sqlite3_bind_text(stmt, <var>1</var>, key.c_str(), -<var>1</var>, <b>nullptr</b>);</td></tr><tr><th id="L170">170</th><td>  sqlite3_bind_text(stmt, <var>2</var>, value.c_str(), -<var>1</var>, <b>nullptr</b>);</td></tr><tr><th id="L171">171</th><td/></tr><tr><th id="L172">172</th><td>  sqlite3_step(stmt);</td></tr><tr><th id="L173">173</th><td/></tr><tr><th id="L174">174</th><td>  sqlite3_finalize(stmt);</td></tr><tr><th id="L175">175</th><td>}</td></tr><tr><th id="L176">176</th><td/></tr><tr><th id="L177">177</th><td><a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span> <dfn class="fn" sym-ref="4801.select_info">select_info</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <em>const</em> <a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span>&amp; key)</td></tr><tr><th id="L178">178</th><td>{</td></tr><tr><th id="L179">179</th><td>  sqlite3_stmt* stmt = <b>nullptr</b>;</td></tr><tr><th id="L180">180</th><td/></tr><tr><th id="L181">181</th><td>  sqlite3_prepare_v2(db.sqliteHandle(),</td></tr><tr><th id="L182">182</th><td>    <var>"SELECT value FROM info WHERE key = ?"</var>,</td></tr><tr><th id="L183">183</th><td>    -<var>1</var>, &amp;stmt, <b>nullptr</b>);</td></tr><tr><th id="L184">184</th><td/></tr><tr><th id="L185">185</th><td>  sqlite3_bind_text(stmt, <var>1</var>, key.c_str(), -<var>1</var>, <b>nullptr</b>);</td></tr><tr><th id="L186">186</th><td/></tr><tr><th id="L187">187</th><td>  <a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span> <span class="member constructor" sym-ref="1753.basic_string<_Elem, _Traits, _Alloc>">result</span>;</td></tr><tr><th id="L188">188</th><td/></tr><tr><th id="L189">189</th><td>  <b>if</b> (sqlite3_step(stmt) == SQLITE_ROW)</td></tr><tr><th id="L190">190</th><td>  {</td></tr><tr><th id="L191">191</th><td>    result = <b>reinterpret_cast</b>&lt;<em>const</em> <em>char</em>*&gt;(sqlite3_column_text(stmt, <var>0</var>));</td></tr><tr><th id="L192">192</th><td>  }</td></tr><tr><th id="L193">193</th><td/></tr><tr><th id="L194">194</th><td>  sqlite3_finalize(stmt);</td></tr><tr><th id="L195">195</th><td/></tr><tr><th id="L196">196</th><td>  <b>return</b> <span class="member constructor" sym-ref="64.basic_string<_Elem, _Traits, _Alloc>">result</span>;</td></tr><tr><th id="L197">197</th><td>}</td></tr><tr><th id="L198">198</th><td/></tr><tr><th id="L199">199</th><td>std::vector&lt;SymbolReference&gt; <dfn class="fn" sym-ref="4802.select_from_symbolreference">select_from_symbolreference</dfn>(Database&amp; db, SymbolId symbol)</td></tr><tr><th id="L200">200</th><td>{</td></tr><tr><th id="L201">201</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"SELECT file_id, line, col, parent_symbol_id, flags FROM symbolreference WHERE symbol_id = ?"</var> };</td></tr><tr><th id="L202">202</th><td/></tr><tr><th id="L203">203</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>1</var>, symbol.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>());</td></tr><tr><th id="L204">204</th><td/></tr><tr><th id="L205">205</th><td>  <b>return</b> <a href="sqlqueries.cpp.html#L144" class="fn" sym-ref="4872.read_vector">read_vector</a>&lt;<a href="../../model/include/csnap/model/reference.h.html#L16" class="type struct" sym-ref="4582.SymbolReference">SymbolReference</a>&gt;(stmt, [&amp;symbol](<span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a>&amp; stmt) {</td></tr><tr><th id="L206">206</th><td>    <a href="../../model/include/csnap/model/reference.h.html#L16" class="type struct" sym-ref="4582.SymbolReference">SymbolReference</a> symref;</td></tr><tr><th id="L207">207</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L22" class="member field" sym-ref="4584.file_id">file_id</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>0</var>);</td></tr><tr><th id="L208">208</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L21" class="member field" sym-ref="4583.symbol_id">symbol_id</a> = symbol.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>();</td></tr><tr><th id="L209">209</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L23" class="member field" sym-ref="4585.line">line</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>1</var>);</td></tr><tr><th id="L210">210</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L24" class="member field" sym-ref="4586.col">col</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>2</var>);</td></tr><tr><th id="L211">211</th><td/></tr><tr><th id="L212">212</th><td>    <b>if</b> (stmt.<a href="../include/csnap/database/sql.h.html#L133" class="member memfn" sym-ref="4795.nullColumn">nullColumn</a>(<var>3</var>))</td></tr><tr><th id="L213">213</th><td>      symref.<a href="../../model/include/csnap/model/reference.h.html#L29" class="member field" sym-ref="4587.parent_symbol_id">parent_symbol_id</a> <a href="../../model/include/csnap/model/identifier.h.html#L38" class="member memfn" sym-ref="4527.operator=">=</a> <a href="../../model/include/csnap/model/symbolid.h.html#L15" class="type cxxtypealias" sym-ref="4581.SymbolId">SymbolId</a>();</td></tr><tr><th id="L214">214</th><td>    <b>else</b></td></tr><tr><th id="L215">215</th><td>      symref.<a href="../../model/include/csnap/model/reference.h.html#L29" class="member field" sym-ref="4587.parent_symbol_id">parent_symbol_id</a> <a href="../../model/include/csnap/model/identifier.h.html#L38" class="member memfn" sym-ref="4527.operator=">=</a> <a href="../../model/include/csnap/model/identifier.h.html#L22" class="member constructor" sym-ref="4524.Identifier<T>">SymbolId</a>(stmt.columnInt(<var>3</var>));</td></tr><tr><th id="L216">216</th><td/></tr><tr><th id="L217">217</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L34" class="member field" sym-ref="4588.flags">flags</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>4</var>);</td></tr><tr><th id="L218">218</th><td/></tr><tr><th id="L219">219</th><td>    <b>return</b> symref;</td></tr><tr><th id="L220">220</th><td>    });</td></tr><tr><th id="L221">221</th><td>}</td></tr><tr><th id="L222">222</th><td/></tr><tr><th id="L223">223</th><td><i>/**</i></td></tr><tr><th id="L224">224</th><td><i> * \brief select all symbol references in a given file</i></td></tr><tr><th id="L225">225</th><td><i> */</i></td></tr><tr><th id="L226">226</th><td>std::vector&lt;SymbolReference&gt; <dfn class="fn" sym-ref="4803.select_symbolreference">select_symbolreference</dfn>(Database&amp; db, FileId file)</td></tr><tr><th id="L227">227</th><td>{</td></tr><tr><th id="L228">228</th><td>  std::vector&lt;SymbolReference&gt; r;</td></tr><tr><th id="L229">229</th><td/></tr><tr><th id="L230">230</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"SELECT symbol_id, line, col, parent_symbol_id, flags FROM symbolreference WHERE file_id = ?"</var> };</td></tr><tr><th id="L231">231</th><td/></tr><tr><th id="L232">232</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>1</var>, file.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>());</td></tr><tr><th id="L233">233</th><td/></tr><tr><th id="L234">234</th><td>  <a href="../../model/include/csnap/model/reference.h.html#L16" class="type struct" sym-ref="4582.SymbolReference">SymbolReference</a> symref;</td></tr><tr><th id="L235">235</th><td>  symref.<a href="../../model/include/csnap/model/reference.h.html#L22" class="member field" sym-ref="4584.file_id">file_id</a> = file.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>();</td></tr><tr><th id="L236">236</th><td/></tr><tr><th id="L237">237</th><td>  <b>while</b> (stmt.<a href="../include/csnap/database/sql.h.html#L81" class="member memfn" sym-ref="4785.step">step</a>())</td></tr><tr><th id="L238">238</th><td>  {</td></tr><tr><th id="L239">239</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L21" class="member field" sym-ref="4583.symbol_id">symbol_id</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>0</var>);</td></tr><tr><th id="L240">240</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L23" class="member field" sym-ref="4585.line">line</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>1</var>);</td></tr><tr><th id="L241">241</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L24" class="member field" sym-ref="4586.col">col</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>2</var>);</td></tr><tr><th id="L242">242</th><td/></tr><tr><th id="L243">243</th><td>    <b>if</b> (stmt.<a href="../include/csnap/database/sql.h.html#L133" class="member memfn" sym-ref="4795.nullColumn">nullColumn</a>(<var>3</var>))</td></tr><tr><th id="L244">244</th><td>      symref.<a href="../../model/include/csnap/model/reference.h.html#L29" class="member field" sym-ref="4587.parent_symbol_id">parent_symbol_id</a> <a href="../../model/include/csnap/model/identifier.h.html#L38" class="member memfn" sym-ref="4527.operator=">=</a> <a href="../../model/include/csnap/model/symbolid.h.html#L15" class="type cxxtypealias" sym-ref="4581.SymbolId">SymbolId</a>();</td></tr><tr><th id="L245">245</th><td>    <b>else</b></td></tr><tr><th id="L246">246</th><td>      symref.<a href="../../model/include/csnap/model/reference.h.html#L29" class="member field" sym-ref="4587.parent_symbol_id">parent_symbol_id</a> <a href="../../model/include/csnap/model/identifier.h.html#L38" class="member memfn" sym-ref="4527.operator=">=</a> <a href="../../model/include/csnap/model/identifier.h.html#L22" class="member constructor" sym-ref="4524.Identifier<T>">SymbolId</a>(stmt.columnInt(<var>3</var>));</td></tr><tr><th id="L247">247</th><td/></tr><tr><th id="L248">248</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L34" class="member field" sym-ref="4588.flags">flags</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>4</var>);</td></tr><tr><th id="L249">249</th><td/></tr><tr><th id="L250">250</th><td>    r.push_back(symref);</td></tr><tr><th id="L251">251</th><td>  }</td></tr><tr><th id="L252">252</th><td/></tr><tr><th id="L253">253</th><td>  <b>return</b> r;</td></tr><tr><th id="L254">254</th><td>}</td></tr><tr><th id="L255">255</th><td/></tr><tr><th id="L256">256</th><td><i>/**</i></td></tr><tr><th id="L257">257</th><td><i> * \brief select all rows from the symboldefinition table</i></td></tr><tr><th id="L258">258</th><td><i> * </i></td></tr><tr><th id="L259">259</th><td><i> * Note: currently the \em parent_symbol_id field of the SymbolReference </i></td></tr><tr><th id="L260">260</th><td><i> * struct is not filled.</i></td></tr><tr><th id="L261">261</th><td><i> */</i></td></tr><tr><th id="L262">262</th><td>std::vector&lt;SymbolReference&gt; <dfn class="fn" sym-ref="4804.select_symboldefinition">select_symboldefinition</dfn>(Database&amp; db)</td></tr><tr><th id="L263">263</th><td>{</td></tr><tr><th id="L264">264</th><td>  <i>// $TODO: this could be rewritten using read_vector()</i></td></tr><tr><th id="L265">265</th><td/></tr><tr><th id="L266">266</th><td>  std::vector&lt;SymbolReference&gt; r;</td></tr><tr><th id="L267">267</th><td/></tr><tr><th id="L268">268</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"SELECT symbol_id, file_id, line, col, flags FROM symboldefinition"</var> };</td></tr><tr><th id="L269">269</th><td/></tr><tr><th id="L270">270</th><td>  <b>while</b> (stmt.<a href="../include/csnap/database/sql.h.html#L81" class="member memfn" sym-ref="4785.step">step</a>())</td></tr><tr><th id="L271">271</th><td>  {</td></tr><tr><th id="L272">272</th><td>    <a href="../../model/include/csnap/model/reference.h.html#L16" class="type struct" sym-ref="4582.SymbolReference">SymbolReference</a> symref;</td></tr><tr><th id="L273">273</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L21" class="member field" sym-ref="4583.symbol_id">symbol_id</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>0</var>);</td></tr><tr><th id="L274">274</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L22" class="member field" sym-ref="4584.file_id">file_id</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>1</var>);</td></tr><tr><th id="L275">275</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L23" class="member field" sym-ref="4585.line">line</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>2</var>);</td></tr><tr><th id="L276">276</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L24" class="member field" sym-ref="4586.col">col</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>3</var>);</td></tr><tr><th id="L277">277</th><td>    symref.<a href="../../model/include/csnap/model/reference.h.html#L34" class="member field" sym-ref="4588.flags">flags</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>4</var>);</td></tr><tr><th id="L278">278</th><td/></tr><tr><th id="L279">279</th><td>    <i>/*</i></td></tr><tr><th id="L280">280</th><td><i>    if (stmt.nullColumn(4))</i></td></tr><tr><th id="L281">281</th><td><i>      symref.parent_symbol_id = SymbolId();</i></td></tr><tr><th id="L282">282</th><td><i>    else</i></td></tr><tr><th id="L283">283</th><td><i>      symref.parent_symbol_id = SymbolId(stmt.columnInt(3));</i></td></tr><tr><th id="L284">284</th><td><i>*/</i></td></tr><tr><th id="L285">285</th><td>    r.push_back(symref);</td></tr><tr><th id="L286">286</th><td>  }</td></tr><tr><th id="L287">287</th><td/></tr><tr><th id="L288">288</th><td>  <b>return</b> r;</td></tr><tr><th id="L289">289</th><td>}</td></tr><tr><th id="L290">290</th><td/></tr><tr><th id="L291">291</th><td><i>/**</i></td></tr><tr><th id="L292">292</th><td><i> * \brief select all rows from the base table with a specified value for the symbol_id column</i></td></tr><tr><th id="L293">293</th><td><i> * \param db         the database</i></td></tr><tr><th id="L294">294</th><td><i> * \param symbol_id  desired value for the symbol_id column</i></td></tr><tr><th id="L295">295</th><td><i> */</i></td></tr><tr><th id="L296">296</th><td>std::vector&lt;BaseClass&gt; <dfn class="fn" sym-ref="4805.select_from_base">select_from_base</dfn>(Database&amp; db, SymbolId symbol_id)</td></tr><tr><th id="L297">297</th><td>{</td></tr><tr><th id="L298">298</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"SELECT base_id, access_specifier FROM base WHERE symbol_id = ?"</var> };</td></tr><tr><th id="L299">299</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>1</var>, symbol_id.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>());</td></tr><tr><th id="L300">300</th><td/></tr><tr><th id="L301">301</th><td>  <b>return</b> <a href="sqlqueries.cpp.html#L144" class="fn" sym-ref="4872.read_vector">read_vector</a>&lt;<a href="../../model/include/csnap/model/symbol.h.html#L153" class="type struct" sym-ref="4669.BaseClass">BaseClass</a>&gt;(stmt, [](<span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a>&amp; q) {</td></tr><tr><th id="L302">302</th><td>    <a href="../../model/include/csnap/model/symbol.h.html#L153" class="type struct" sym-ref="4669.BaseClass">BaseClass</a> base;</td></tr><tr><th id="L303">303</th><td>    base.<a href="../../model/include/csnap/model/symbol.h.html#L156" class="member field" sym-ref="4671.base_id">base_id</a> <a href="../../model/include/csnap/model/identifier.h.html#L38" class="member memfn" sym-ref="4527.operator=">=</a> <a href="../../model/include/csnap/model/symbolid.h.html#L15" class="type cxxtypealias" sym-ref="4581.SymbolId">SymbolId</a>(q.columnInt(<var>0</var>));</td></tr><tr><th id="L304">304</th><td>    base.<a href="../../model/include/csnap/model/symbol.h.html#L155" class="member field" sym-ref="4670.access_specifier">access_specifier</a> = <b>static_cast</b>&lt;<a href="../../model/include/csnap/model/symbol.h.html#L15" class="type enum" sym-ref="4600.AccessSpecifier">AccessSpecifier</a>&gt;(q.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>1</var>));</td></tr><tr><th id="L305">305</th><td>    <b>return</b> base;</td></tr><tr><th id="L306">306</th><td>    });</td></tr><tr><th id="L307">307</th><td>}</td></tr><tr><th id="L308">308</th><td/></tr><tr><th id="L309">309</th><td><i>/**</i></td></tr><tr><th id="L310">310</th><td><i> * \brief select the symbol_id column from the base table with a specified value for the base_id column</i></td></tr><tr><th id="L311">311</th><td><i> * \param db       the database</i></td></tr><tr><th id="L312">312</th><td><i> * \param base_id  desired value for the base_id column</i></td></tr><tr><th id="L313">313</th><td><i> */</i></td></tr><tr><th id="L314">314</th><td>std::vector&lt;SymbolId&gt; <dfn class="fn" sym-ref="4806.select_symbold_id_from_base">select_symbold_id_from_base</dfn>(Database&amp; db, SymbolId base_id)</td></tr><tr><th id="L315">315</th><td>{</td></tr><tr><th id="L316">316</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"SELECT symbol_id FROM base WHERE base_id = ?"</var> };</td></tr><tr><th id="L317">317</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>1</var>, base_id.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>());</td></tr><tr><th id="L318">318</th><td/></tr><tr><th id="L319">319</th><td>  <b>return</b> <a href="sqlqueries.cpp.html#L144" class="fn" sym-ref="4872.read_vector">read_vector</a>&lt;<a href="../../model/include/csnap/model/symbolid.h.html#L15" class="type cxxtypealias" sym-ref="4581.SymbolId">SymbolId</a>&gt;(stmt, [](<span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a>&amp; q) {</td></tr><tr><th id="L320">320</th><td>    <b>return</b> <a href="../../model/include/csnap/model/identifier.h.html#L19" class="member constructor" sym-ref="4522.Identifier<T>">SymbolId</a>(q.columnInt(<var>0</var>));</td></tr><tr><th id="L321">321</th><td>    });</td></tr><tr><th id="L322">322</th><td>}</td></tr><tr><th id="L323">323</th><td/></tr><tr><th id="L324">324</th><td><em>void</em> <dfn class="fn" sym-ref="4807.insert_file">insert_file</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <em>const</em> <a href="../../model/include/csnap/model/file.h.html#L15" class="type struct" sym-ref="4532.File">File</a>&amp; file)</td></tr><tr><th id="L325">325</th><td>{</td></tr><tr><th id="L326">326</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"INSERT INTO file(id, path) VALUES(?,?)"</var> };</td></tr><tr><th id="L327">327</th><td/></tr><tr><th id="L328">328</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>1</var>, file.<a href="../../model/include/csnap/model/file.h.html#L17" class="member field" sym-ref="4534.id">id</a>.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>());</td></tr><tr><th id="L329">329</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L113" class="member memfn" sym-ref="4791.bind">bind</a>(<var>2</var>, file.<a href="../../model/include/csnap/model/file.h.html#L18" class="member field" sym-ref="4535.path">path</a>.<span class="member memfn" sym-ref="61.c_str">c_str</span>());</td></tr><tr><th id="L330">330</th><td/></tr><tr><th id="L331">331</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L81" class="member memfn" sym-ref="4785.step">step</a>();</td></tr><tr><th id="L332">332</th><td/></tr><tr><th id="L333">333</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L92" class="member memfn" sym-ref="4787.finalize">finalize</a>();</td></tr><tr><th id="L334">334</th><td>}</td></tr><tr><th id="L335">335</th><td/></tr><tr><th id="L336">336</th><td><em>void</em> <dfn class="fn" sym-ref="4808.insert_file_content">insert_file_content</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <em>const</em> std::vector&lt;File*&gt;&amp; files)</td></tr><tr><th id="L337">337</th><td>{</td></tr><tr><th id="L338">338</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"UPDATE file SET content = ? WHERE id = ?"</var> };</td></tr><tr><th id="L339">339</th><td/></tr><tr><th id="L340">340</th><td>  <b>for</b> (File* f : files)</td></tr><tr><th id="L341">341</th><td>  {</td></tr><tr><th id="L342">342</th><td>    <b>if</b> (!f)</td></tr><tr><th id="L343">343</th><td>      <b>continue</b>;</td></tr><tr><th id="L344">344</th><td/></tr><tr><th id="L345">345</th><td>    std::filesystem::path filepath{ f-&gt;path };</td></tr><tr><th id="L346">346</th><td/></tr><tr><th id="L347">347</th><td>    <b>if</b> (!std::filesystem::exists(filepath))</td></tr><tr><th id="L348">348</th><td>      <b>continue</b>;</td></tr><tr><th id="L349">349</th><td/></tr><tr><th id="L350">350</th><td>    std::string bytes = Snapshot::readFile(filepath);</td></tr><tr><th id="L351">351</th><td/></tr><tr><th id="L352">352</th><td>    stmt.bind(<var>2</var>, f-&gt;id.value());</td></tr><tr><th id="L353">353</th><td>    stmt.bind(<var>1</var>, bytes.c_str());</td></tr><tr><th id="L354">354</th><td/></tr><tr><th id="L355">355</th><td>    stmt.step();</td></tr><tr><th id="L356">356</th><td>    stmt.reset();</td></tr><tr><th id="L357">357</th><td>  }</td></tr><tr><th id="L358">358</th><td/></tr><tr><th id="L359">359</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L92" class="member memfn" sym-ref="4787.finalize">finalize</a>();</td></tr><tr><th id="L360">360</th><td>}</td></tr><tr><th id="L361">361</th><td/></tr><tr><th id="L362">362</th><td><b>static</b> <a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span> <dfn class="fn" sym-ref="4873.join">join</dfn>(<em>const</em> std::vector&lt;std::string&gt;&amp; list, <em>char</em> sep = <var>';'</var>)</td></tr><tr><th id="L363">363</th><td>{</td></tr><tr><th id="L364">364</th><td>  <b>if</b> (list.empty())</td></tr><tr><th id="L365">365</th><td>    <b>return</b> <span class="member constructor" sym-ref="1753.basic_string<_Elem, _Traits, _Alloc>">{</span>};</td></tr><tr><th id="L366">366</th><td>  <b>else</b> <b>if</b> (list.size() == <var>1</var>)</td></tr><tr><th id="L367">367</th><td>    <b>return</b> list.front();</td></tr><tr><th id="L368">368</th><td/></tr><tr><th id="L369">369</th><td>  size_t s = std::accumulate(list.begin(), list.end(), size_t(<var>0</var>), [](size_t n, <em>const</em> std::string&amp; str) {</td></tr><tr><th id="L370">370</th><td>    <b>return</b> n + str.size();</td></tr><tr><th id="L371">371</th><td>    });</td></tr><tr><th id="L372">372</th><td/></tr><tr><th id="L373">373</th><td>  s += (list.size() - <var>1</var>);</td></tr><tr><th id="L374">374</th><td/></tr><tr><th id="L375">375</th><td>  <a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span> <span class="member constructor" sym-ref="1753.basic_string<_Elem, _Traits, _Alloc>">str</span>;</td></tr><tr><th id="L376">376</th><td>  str.<span class="member memfn" sym-ref="1754.reserve">reserve</span>(s);</td></tr><tr><th id="L377">377</th><td/></tr><tr><th id="L378">378</th><td>  <b>auto</b> it = list.begin();</td></tr><tr><th id="L379">379</th><td/></tr><tr><th id="L380">380</th><td>  <b>for</b> (; it != std::prev(list.end()); ++it)</td></tr><tr><th id="L381">381</th><td>  {</td></tr><tr><th id="L382">382</th><td>    str.insert(str.end(), it-&gt;begin(), it-&gt;end());</td></tr><tr><th id="L383">383</th><td>    str.push_back(sep);</td></tr><tr><th id="L384">384</th><td>  }</td></tr><tr><th id="L385">385</th><td/></tr><tr><th id="L386">386</th><td>  str.insert(str.end(), it-&gt;begin(), it-&gt;end());</td></tr><tr><th id="L387">387</th><td/></tr><tr><th id="L388">388</th><td>  <b>return</b> <span class="member constructor" sym-ref="64.basic_string<_Elem, _Traits, _Alloc>">str</span>;</td></tr><tr><th id="L389">389</th><td>}</td></tr><tr><th id="L390">390</th><td/></tr><tr><th id="L391">391</th><td><b>static</b> <a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span> <dfn class="fn" sym-ref="4874.join_defines">join_defines</dfn>(<em>const</em> std::map&lt;std::string, std::string&gt;&amp; defines)</td></tr><tr><th id="L392">392</th><td>{</td></tr><tr><th id="L393">393</th><td>  std::vector&lt;std::string&gt; list;</td></tr><tr><th id="L394">394</th><td/></tr><tr><th id="L395">395</th><td>  <b>for</b> (<em>const</em> std::pair&lt;<em>const</em> std::string, std::string&gt;&amp; d : defines)</td></tr><tr><th id="L396">396</th><td>  {</td></tr><tr><th id="L397">397</th><td>    <b>if</b> (d.second.empty())</td></tr><tr><th id="L398">398</th><td>      list.push_back(d.first);</td></tr><tr><th id="L399">399</th><td>    <b>else</b></td></tr><tr><th id="L400">400</th><td>      list.push_back(d.first + <var>"="</var> + d.second);</td></tr><tr><th id="L401">401</th><td>  }</td></tr><tr><th id="L402">402</th><td/></tr><tr><th id="L403">403</th><td>  <b>return</b> join(list);</td></tr><tr><th id="L404">404</th><td>}</td></tr><tr><th id="L405">405</th><td/></tr><tr><th id="L406">406</th><td><b>static</b> <a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span> <dfn class="fn" sym-ref="4875.join_includedirs">join_includedirs</dfn>(<em>const</em> std::set&lt;std::string&gt;&amp; includedirs)</td></tr><tr><th id="L407">407</th><td>{</td></tr><tr><th id="L408">408</th><td>  <b>return</b> join(std::vector&lt;std::string&gt;(includedirs.begin(), includedirs.end()));</td></tr><tr><th id="L409">409</th><td>}</td></tr><tr><th id="L410">410</th><td/></tr><tr><th id="L411">411</th><td><b>static</b> <em>int</em> <dfn class="fn" sym-ref="4876.get_compile_options_id">get_compile_options_id</dfn>(std::map&lt;<em>const</em> program::CompileOptions*, <em>int</em>&gt;&amp; map, <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a>&amp; insert_query, <em>const</em> <span class="namespace" sym-ref="4565.program">program</span>::<a href="../../model/include/csnap/model/translationunit.h.html#L22" class="type struct" sym-ref="4566.CompileOptions">CompileOptions</a>* copts)</td></tr><tr><th id="L412">412</th><td>{</td></tr><tr><th id="L413">413</th><td>  <b>auto</b> it = map.find(copts);</td></tr><tr><th id="L414">414</th><td/></tr><tr><th id="L415">415</th><td>  <b>if</b> (it != map.end())</td></tr><tr><th id="L416">416</th><td>    <b>return</b> it-&gt;second;</td></tr><tr><th id="L417">417</th><td/></tr><tr><th id="L418">418</th><td>  insert_query.bind(<var>1</var>, join_defines(copts-&gt;defines));</td></tr><tr><th id="L419">419</th><td>  insert_query.bind(<var>2</var>, join_includedirs(copts-&gt;includedirs));</td></tr><tr><th id="L420">420</th><td/></tr><tr><th id="L421">421</th><td>  insert_query.<a href="../include/csnap/database/sql.h.html#L81" class="member memfn" sym-ref="4785.step">step</a>();</td></tr><tr><th id="L422">422</th><td>  insert_query.<a href="../include/csnap/database/sql.h.html#L87" class="member memfn" sym-ref="4786.reset">reset</a>();</td></tr><tr><th id="L423">423</th><td/></tr><tr><th id="L424">424</th><td>  <em>int</em> id = insert_query.<a href="../include/csnap/database/sql.h.html#L103" class="member memfn" sym-ref="4789.rowid">rowid</a>();</td></tr><tr><th id="L425">425</th><td/></tr><tr><th id="L426">426</th><td>  map[copts] = id;</td></tr><tr><th id="L427">427</th><td/></tr><tr><th id="L428">428</th><td>  <b>return</b> id;</td></tr><tr><th id="L429">429</th><td>}</td></tr><tr><th id="L430">430</th><td/></tr><tr><th id="L431">431</th><td><em>void</em> <dfn class="fn" sym-ref="4809.insert_translationunit">insert_translationunit</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <em>const</em> std::vector&lt;TranslationUnit*&gt;&amp; units)</td></tr><tr><th id="L432">432</th><td>{</td></tr><tr><th id="L433">433</th><td>  std::map&lt;<em>const</em> program::CompileOptions*, <em>int</em>&gt; copts_ids;</td></tr><tr><th id="L434">434</th><td/></tr><tr><th id="L435">435</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">coptions_query</a>{ db, <var>"INSERT INTO compileoptions(defines, includedirs) VALUES(?,?)"</var> };</td></tr><tr><th id="L436">436</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"INSERT INTO translationunit(id, file_id, compileoptions_id) VALUES(?, ?, ?)"</var> };</td></tr><tr><th id="L437">437</th><td/></tr><tr><th id="L438">438</th><td>  <b>for</b> (TranslationUnit* tu : units)</td></tr><tr><th id="L439">439</th><td>  {</td></tr><tr><th id="L440">440</th><td>    stmt.bind(<var>1</var>, tu-&gt;id.value());</td></tr><tr><th id="L441">441</th><td>    stmt.bind(<var>2</var>, tu-&gt;sourcefile_id.value());</td></tr><tr><th id="L442">442</th><td>    stmt.bind(<var>3</var>, get_compile_options_id(copts_ids, coptions_query, tu-&gt;compile_options.get()));</td></tr><tr><th id="L443">443</th><td/></tr><tr><th id="L444">444</th><td>    stmt.step();</td></tr><tr><th id="L445">445</th><td>    stmt.reset();</td></tr><tr><th id="L446">446</th><td>  }</td></tr><tr><th id="L447">447</th><td/></tr><tr><th id="L448">448</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L92" class="member memfn" sym-ref="4787.finalize">finalize</a>();</td></tr><tr><th id="L449">449</th><td>}</td></tr><tr><th id="L450">450</th><td/></tr><tr><th id="L451">451</th><td><em>void</em> <dfn class="fn" sym-ref="4810.insert_translationunit_ast">insert_translationunit_ast</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <a href="../../model/include/csnap/model/translationunit.h.html#L30" class="type struct" sym-ref="4563.TranslationUnit">TranslationUnit</a>* tu, <em>const</em> <a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span>&amp; bytes)</td></tr><tr><th id="L452">452</th><td>{</td></tr><tr><th id="L453">453</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"UPDATE translationunit SET ast = ? WHERE id = ?"</var> };</td></tr><tr><th id="L454">454</th><td/></tr><tr><th id="L455">455</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>2</var>, tu-&gt;<a href="../../model/include/csnap/model/translationunit.h.html#L32" class="member field" sym-ref="4569.id">id</a>.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>());</td></tr><tr><th id="L456">456</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L128" class="member memfn" sym-ref="4794.bindBlob">bindBlob</a>(<var>1</var>, bytes);</td></tr><tr><th id="L457">457</th><td/></tr><tr><th id="L458">458</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L81" class="member memfn" sym-ref="4785.step">step</a>();</td></tr><tr><th id="L459">459</th><td/></tr><tr><th id="L460">460</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L92" class="member memfn" sym-ref="4787.finalize">finalize</a>();</td></tr><tr><th id="L461">461</th><td>}</td></tr><tr><th id="L462">462</th><td/></tr><tr><th id="L463">463</th><td><em>void</em> <dfn class="fn" sym-ref="4811.insert_ppinclude">insert_ppinclude</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <em>const</em> <a href="../../model/include/csnap/model/translationunit.h.html#L30" class="type struct" sym-ref="4563.TranslationUnit">TranslationUnit</a>&amp; tu, <em>const</em> std::vector&lt;Include&gt;&amp; includes)</td></tr><tr><th id="L464">464</th><td>{</td></tr><tr><th id="L465">465</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"INSERT INTO ppinclude (translationunit_id, file_id, line, included_file_id) VALUES(?,?,?,?)"</var> };</td></tr><tr><th id="L466">466</th><td/></tr><tr><th id="L467">467</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>1</var>, tu.<a href="../../model/include/csnap/model/translationunit.h.html#L32" class="member field" sym-ref="4569.id">id</a>.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>());</td></tr><tr><th id="L468">468</th><td/></tr><tr><th id="L469">469</th><td>  <b>for</b> (<em>const</em> Include&amp; inc : includes)</td></tr><tr><th id="L470">470</th><td>  {</td></tr><tr><th id="L471">471</th><td>    stmt.bind(<var>2</var>, inc.file_id.value());</td></tr><tr><th id="L472">472</th><td>    stmt.bind(<var>3</var>, inc.line);</td></tr><tr><th id="L473">473</th><td>    stmt.bind(<var>4</var>, inc.included_file_id.value());</td></tr><tr><th id="L474">474</th><td/></tr><tr><th id="L475">475</th><td>    stmt.step();</td></tr><tr><th id="L476">476</th><td>    stmt.reset();</td></tr><tr><th id="L477">477</th><td>  }</td></tr><tr><th id="L478">478</th><td/></tr><tr><th id="L479">479</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L92" class="member memfn" sym-ref="4787.finalize">finalize</a>();</td></tr><tr><th id="L480">480</th><td>}</td></tr><tr><th id="L481">481</th><td/></tr><tr><th id="L482">482</th><td><em>void</em> <dfn class="fn" sym-ref="4812.insert_includes">insert_includes</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <em>const</em> std::vector&lt;Include&gt;&amp; includes)</td></tr><tr><th id="L483">483</th><td>{</td></tr><tr><th id="L484">484</th><td>  <i>// We use INSERT OR IGNORE here so that duplicates are automatically ignored by sqlite.</i></td></tr><tr><th id="L485">485</th><td>  <i>// See the UNIQUE constraint in the CREATE statement of the "include" table.</i></td></tr><tr><th id="L486">486</th><td/></tr><tr><th id="L487">487</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"INSERT OR IGNORE INTO include (file_id, line, included_file_id) VALUES(?,?,?)"</var> };</td></tr><tr><th id="L488">488</th><td/></tr><tr><th id="L489">489</th><td>  <b>for</b> (<em>const</em> Include&amp; inc : includes)</td></tr><tr><th id="L490">490</th><td>  {</td></tr><tr><th id="L491">491</th><td>    stmt.bind(<var>1</var>, inc.file_id.value());</td></tr><tr><th id="L492">492</th><td>    stmt.bind(<var>2</var>, inc.line);</td></tr><tr><th id="L493">493</th><td>    stmt.bind(<var>3</var>, inc.included_file_id.value());</td></tr><tr><th id="L494">494</th><td/></tr><tr><th id="L495">495</th><td>    stmt.step();</td></tr><tr><th id="L496">496</th><td>    stmt.reset();</td></tr><tr><th id="L497">497</th><td>  }</td></tr><tr><th id="L498">498</th><td/></tr><tr><th id="L499">499</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L92" class="member memfn" sym-ref="4787.finalize">finalize</a>();</td></tr><tr><th id="L500">500</th><td>}</td></tr><tr><th id="L501">501</th><td/></tr><tr><th id="L502">502</th><td><em>void</em> <dfn class="fn" sym-ref="4813.insert_symbol">insert_symbol</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <em>const</em> <a href="../../model/include/csnap/model/symbol.h.html#L63" class="type struct" sym-ref="4580.Symbol">Symbol</a>&amp; sym)</td></tr><tr><th id="L503">503</th><td>{</td></tr><tr><th id="L504">504</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"INSERT OR REPLACE INTO symbol(id, what, parent, name, displayname, flags) VALUES(?,?,?,?,?,?)"</var> };</td></tr><tr><th id="L505">505</th><td/></tr><tr><th id="L506">506</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>1</var>, sym.<a href="../../model/include/csnap/model/symbol.h.html#L65" class="member field" sym-ref="4635.id">id</a>.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>());</td></tr><tr><th id="L507">507</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>2</var>, <b>static_cast</b>&lt;<em>int</em>&gt;(sym.<a href="../../model/include/csnap/model/symbol.h.html#L66" class="member field" sym-ref="4636.kind">kind</a>));</td></tr><tr><th id="L508">508</th><td/></tr><tr><th id="L509">509</th><td>  <b>if</b> (sym.<a href="../../model/include/csnap/model/symbol.h.html#L70" class="member field" sym-ref="4640.parent_id">parent_id</a>.<a href="../../model/include/csnap/model/identifier.h.html#L33" class="member memfn" sym-ref="4526.valid">valid</a>())</td></tr><tr><th id="L510">510</th><td>    stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>3</var>, sym.<a href="../../model/include/csnap/model/symbol.h.html#L70" class="member field" sym-ref="4640.parent_id">parent_id</a>.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>());</td></tr><tr><th id="L511">511</th><td>  <b>else</b></td></tr><tr><th id="L512">512</th><td>    stmt.<a href="../include/csnap/database/sql.h.html#L108" class="member memfn" sym-ref="4790.bind">bind</a>(<var>3</var>, <b>nullptr</b>);</td></tr><tr><th id="L513">513</th><td/></tr><tr><th id="L514">514</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L113" class="member memfn" sym-ref="4791.bind">bind</a>(<var>4</var>, sym.<a href="../../model/include/csnap/model/symbol.h.html#L67" class="member field" sym-ref="4637.name">name</a>.<span class="member memfn" sym-ref="61.c_str">c_str</span>());</td></tr><tr><th id="L515">515</th><td/></tr><tr><th id="L516">516</th><td>  <b>if</b> (!sym.<a href="../../model/include/csnap/model/symbol.h.html#L69" class="member field" sym-ref="4639.display_name">display_name</a>.<span class="member memfn" sym-ref="1751.empty">empty</span>())</td></tr><tr><th id="L517">517</th><td>    stmt.<a href="../include/csnap/database/sql.h.html#L113" class="member memfn" sym-ref="4791.bind">bind</a>(<var>5</var>, sym.<a href="../../model/include/csnap/model/symbol.h.html#L69" class="member field" sym-ref="4639.display_name">display_name</a>.<span class="member memfn" sym-ref="61.c_str">c_str</span>());</td></tr><tr><th id="L518">518</th><td>  <b>else</b></td></tr><tr><th id="L519">519</th><td>    stmt.<a href="../include/csnap/database/sql.h.html#L108" class="member memfn" sym-ref="4790.bind">bind</a>(<var>5</var>, <b>nullptr</b>);</td></tr><tr><th id="L520">520</th><td/></tr><tr><th id="L521">521</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>6</var>, sym.<a href="../../model/include/csnap/model/symbol.h.html#L71" class="member field" sym-ref="4641.flags">flags</a>);</td></tr><tr><th id="L522">522</th><td/></tr><tr><th id="L523">523</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L81" class="member memfn" sym-ref="4785.step">step</a>();</td></tr><tr><th id="L524">524</th><td>}</td></tr><tr><th id="L525">525</th><td/></tr><tr><th id="L526">526</th><td><em>void</em> <dfn class="fn" sym-ref="4814.insert_symbol">insert_symbol</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <em>const</em> std::vector&lt;std::shared_ptr&lt;Symbol&gt;&gt;&amp; symbols)</td></tr><tr><th id="L527">527</th><td>{</td></tr><tr><th id="L528">528</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"INSERT OR REPLACE INTO symbol(id, what, parent, name, usr, displayname, flags) VALUES(?,?,?,?,?,?,?)"</var> };</td></tr><tr><th id="L529">529</th><td/></tr><tr><th id="L530">530</th><td>  <b>for</b> (<b>auto</b> sptr : symbols)</td></tr><tr><th id="L531">531</th><td>  {</td></tr><tr><th id="L532">532</th><td>    <em>const</em> Symbol&amp; sym = *sptr;</td></tr><tr><th id="L533">533</th><td/></tr><tr><th id="L534">534</th><td>    stmt.bind(<var>1</var>, sym.id.value());</td></tr><tr><th id="L535">535</th><td>    stmt.bind(<var>2</var>, <b>static_cast</b>&lt;<em>int</em>&gt;(sym.kind));</td></tr><tr><th id="L536">536</th><td/></tr><tr><th id="L537">537</th><td>    <b>if</b> (sym.parent_id.valid())</td></tr><tr><th id="L538">538</th><td>      stmt.bind(<var>3</var>, sym.parent_id.value());</td></tr><tr><th id="L539">539</th><td>    <b>else</b></td></tr><tr><th id="L540">540</th><td>      stmt.bind(<var>3</var>, <b>nullptr</b>);</td></tr><tr><th id="L541">541</th><td/></tr><tr><th id="L542">542</th><td>    stmt.bind(<var>4</var>, sym.name.c_str());</td></tr><tr><th id="L543">543</th><td>    stmt.bind(<var>5</var>, sym.usr.c_str());</td></tr><tr><th id="L544">544</th><td/></tr><tr><th id="L545">545</th><td>    <b>if</b> (!sym.display_name.empty())</td></tr><tr><th id="L546">546</th><td>      stmt.bind(<var>6</var>, sym.display_name.c_str());</td></tr><tr><th id="L547">547</th><td>    <b>else</b></td></tr><tr><th id="L548">548</th><td>      stmt.bind(<var>6</var>, <b>nullptr</b>);</td></tr><tr><th id="L549">549</th><td/></tr><tr><th id="L550">550</th><td>    stmt.bind(<var>7</var>, sym.flags);</td></tr><tr><th id="L551">551</th><td/></tr><tr><th id="L552">552</th><td>    stmt.step();</td></tr><tr><th id="L553">553</th><td>    stmt.reset();</td></tr><tr><th id="L554">554</th><td>  }</td></tr><tr><th id="L555">555</th><td>}</td></tr><tr><th id="L556">556</th><td/></tr><tr><th id="L557">557</th><td><em>void</em> <dfn class="fn" sym-ref="4815.insert_symbol_references">insert_symbol_references</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <em>const</em> std::vector&lt;SymbolReference&gt;&amp; references)</td></tr><tr><th id="L558">558</th><td>{</td></tr><tr><th id="L559">559</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">query</a>{</td></tr><tr><th id="L560">560</th><td>    db,</td></tr><tr><th id="L561">561</th><td>    <var>"INSERT INTO symbolreference (symbol_id, file_id, line, col, parent_symbol_id, flags) VALUES (?,?,?,?,?,?)"</var></td></tr><tr><th id="L562">562</th><td>  };</td></tr><tr><th id="L563">563</th><td/></tr><tr><th id="L564">564</th><td>  <b>for</b> (<em>const</em> SymbolReference&amp; ref : references)</td></tr><tr><th id="L565">565</th><td>  {</td></tr><tr><th id="L566">566</th><td>    query.bind(<var>1</var>, ref.symbol_id);</td></tr><tr><th id="L567">567</th><td>    query.bind(<var>2</var>, ref.file_id);</td></tr><tr><th id="L568">568</th><td>    query.bind(<var>3</var>, ref.line);</td></tr><tr><th id="L569">569</th><td>    query.bind(<var>4</var>, ref.col);</td></tr><tr><th id="L570">570</th><td/></tr><tr><th id="L571">571</th><td>    <b>if</b> (ref.parent_symbol_id.valid())</td></tr><tr><th id="L572">572</th><td>      query.bind(<var>5</var>, ref.parent_symbol_id.value());</td></tr><tr><th id="L573">573</th><td>    <b>else</b></td></tr><tr><th id="L574">574</th><td>      query.bind(<var>5</var>, <b>nullptr</b>);</td></tr><tr><th id="L575">575</th><td/></tr><tr><th id="L576">576</th><td>    query.bind(<var>6</var>, ref.flags);</td></tr><tr><th id="L577">577</th><td/></tr><tr><th id="L578">578</th><td>    query.step();</td></tr><tr><th id="L579">579</th><td>    query.reset();</td></tr><tr><th id="L580">580</th><td>  }</td></tr><tr><th id="L581">581</th><td/></tr><tr><th id="L582">582</th><td>  query.<a href="../include/csnap/database/sql.h.html#L92" class="member memfn" sym-ref="4787.finalize">finalize</a>();</td></tr><tr><th id="L583">583</th><td>}</td></tr><tr><th id="L584">584</th><td/></tr><tr><th id="L585">585</th><td><em>void</em> <dfn class="fn" sym-ref="4816.insert_base">insert_base</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <em>const</em> std::map&lt;SymbolId, std::vector&lt;BaseClass&gt;&gt;&amp; bases)</td></tr><tr><th id="L586">586</th><td>{</td></tr><tr><th id="L587">587</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">query</a>{</td></tr><tr><th id="L588">588</th><td>   db,</td></tr><tr><th id="L589">589</th><td>   <var>"INSERT INTO base (symbol_id, base_id, access_specifier) VALUES (?,?,?)"</var></td></tr><tr><th id="L590">590</th><td>  };</td></tr><tr><th id="L591">591</th><td/></tr><tr><th id="L592">592</th><td>  <b>for</b> (<em>const</em> std::pair&lt;<em>const</em> SymbolId, std::vector&lt;BaseClass&gt;&gt;&amp; pair : bases)</td></tr><tr><th id="L593">593</th><td>  {</td></tr><tr><th id="L594">594</th><td>    query.bind(<var>1</var>, pair.first.value());</td></tr><tr><th id="L595">595</th><td/></tr><tr><th id="L596">596</th><td>    <b>for</b> (<em>const</em> BaseClass&amp; base : pair.second)</td></tr><tr><th id="L597">597</th><td>    {</td></tr><tr><th id="L598">598</th><td>      query.bind(<var>2</var>, base.base_id.value());</td></tr><tr><th id="L599">599</th><td>      query.bind(<var>3</var>, <b>static_cast</b>&lt;<em>int</em>&gt;(base.access_specifier));</td></tr><tr><th id="L600">600</th><td/></tr><tr><th id="L601">601</th><td>      query.step();</td></tr><tr><th id="L602">602</th><td>      query.reset();</td></tr><tr><th id="L603">603</th><td>    }</td></tr><tr><th id="L604">604</th><td>  }</td></tr><tr><th id="L605">605</th><td/></tr><tr><th id="L606">606</th><td>  query.<a href="../include/csnap/database/sql.h.html#L92" class="member memfn" sym-ref="4787.finalize">finalize</a>();</td></tr><tr><th id="L607">607</th><td>}</td></tr><tr><th id="L608">608</th><td/></tr><tr><th id="L609">609</th><td><a href="../../model/include/csnap/model/file.h.html#L15" class="type struct" sym-ref="4532.File">File</a> <dfn class="fn" sym-ref="4877.read_file">read_file</dfn>(<span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a>&amp; stmt, <em>int</em> id_col = <var>0</var>, <em>int</em> path_col = <var>1</var>)</td></tr><tr><th id="L610">610</th><td>{</td></tr><tr><th id="L611">611</th><td>  <a href="../../model/include/csnap/model/file.h.html#L15" class="type struct" sym-ref="4532.File">File</a> f;</td></tr><tr><th id="L612">612</th><td>  f.<a href="../../model/include/csnap/model/file.h.html#L17" class="member field" sym-ref="4534.id">id</a> <a href="../../model/include/csnap/model/identifier.h.html#L38" class="member memfn" sym-ref="4527.operator=">=</a> <a href="../../model/include/csnap/model/fileid.h.html#L15" class="type cxxtypealias" sym-ref="4533.FileId">FileId</a>(stmt.columnInt(id_col));</td></tr><tr><th id="L613">613</th><td>  f.<a href="../../model/include/csnap/model/file.h.html#L18" class="member field" sym-ref="4535.path">path</a> <span class="member memfn" sym-ref="1752.operator=">=</span> stmt.<a href="../include/csnap/database/sql.h.html#L138" class="member memfn" sym-ref="4796.column">column</a>(path_col);</td></tr><tr><th id="L614">614</th><td>  <b>return</b> f;</td></tr><tr><th id="L615">615</th><td>}</td></tr><tr><th id="L616">616</th><td/></tr><tr><th id="L617">617</th><td>std::vector&lt;File&gt; <dfn class="fn" sym-ref="4817.select_file">select_file</dfn>(Database&amp; db)</td></tr><tr><th id="L618">618</th><td>{</td></tr><tr><th id="L619">619</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"SELECT id, path FROM file"</var> };</td></tr><tr><th id="L620">620</th><td>  <b>return</b> <a href="sqlqueries.cpp.html#L144" class="fn" sym-ref="4872.read_vector">read_vector</a>&lt;<a href="../../model/include/csnap/model/file.h.html#L15" class="type struct" sym-ref="4532.File">File</a>&gt;(stmt, [](<span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a>&amp; q) {</td></tr><tr><th id="L621">621</th><td>    <b>return</b> <a href="sqlqueries.cpp.html#L609" class="fn" sym-ref="4877.read_file">read_file</a>(q);</td></tr><tr><th id="L622">622</th><td>    });</td></tr><tr><th id="L623">623</th><td>}</td></tr><tr><th id="L624">624</th><td/></tr><tr><th id="L625">625</th><td><a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span> <dfn class="fn" sym-ref="4818.select_content_from_file">select_content_from_file</dfn>(<a href="../include/csnap/database/database.h.html#L25" class="type cxxclass" sym-ref="4506.Database">Database</a>&amp; db, <a href="../../model/include/csnap/model/fileid.h.html#L15" class="type cxxtypealias" sym-ref="4533.FileId">FileId</a> file)</td></tr><tr><th id="L626">626</th><td>{</td></tr><tr><th id="L627">627</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"SELECT content FROM file WHERE id = ?"</var> };</td></tr><tr><th id="L628">628</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>1</var>, file.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>());</td></tr><tr><th id="L629">629</th><td/></tr><tr><th id="L630">630</th><td>  <b>if</b> (!stmt.<a href="../include/csnap/database/sql.h.html#L81" class="member memfn" sym-ref="4785.step">step</a>())</td></tr><tr><th id="L631">631</th><td>    <b>return</b> <span class="member constructor" sym-ref="1753.basic_string<_Elem, _Traits, _Alloc>">{</span>};</td></tr><tr><th id="L632">632</th><td/></tr><tr><th id="L633">633</th><td>  <b>if</b> (stmt.<a href="../include/csnap/database/sql.h.html#L133" class="member memfn" sym-ref="4795.nullColumn">nullColumn</a>(<var>0</var>))</td></tr><tr><th id="L634">634</th><td>    <b>return</b> <span class="member constructor" sym-ref="1753.basic_string<_Elem, _Traits, _Alloc>">{</span>};</td></tr><tr><th id="L635">635</th><td>  <b>else</b></td></tr><tr><th id="L636">636</th><td>    <b>return</b> <span class="member constructor" sym-ref="64.basic_string<_Elem, _Traits, _Alloc>">stmt</span>.<a href="../include/csnap/database/sql.h.html#L138" class="member memfn" sym-ref="4796.column">column</a>(<var>0</var>);</td></tr><tr><th id="L637">637</th><td>}</td></tr><tr><th id="L638">638</th><td/></tr><tr><th id="L639">639</th><td><b>template</b>&lt;<b>typename</b> F&gt;</td></tr><tr><th id="L640">640</th><td><b>static</b> <em>void</em> <dfn class="fn" sym-ref="4878.split_apply">split_apply</dfn>(<em>const</em> <a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span>&amp; liststr, <em>char</em> sep, F&amp;&amp; func)</td></tr><tr><th id="L641">641</th><td>{</td></tr><tr><th id="L642">642</th><td>  <b>auto</b> it = liststr.begin();</td></tr><tr><th id="L643">643</th><td>  <b>auto</b> next = std::find(liststr.begin(), liststr.end(), sep);</td></tr><tr><th id="L644">644</th><td/></tr><tr><th id="L645">645</th><td>  <b>while</b> (next != liststr.end())</td></tr><tr><th id="L646">646</th><td>  {</td></tr><tr><th id="L647">647</th><td>    func(std::string(it, next));</td></tr><tr><th id="L648">648</th><td>    it = next + <var>1</var>;</td></tr><tr><th id="L649">649</th><td>    next = std::find(it, liststr.end(), sep);</td></tr><tr><th id="L650">650</th><td>  }</td></tr><tr><th id="L651">651</th><td/></tr><tr><th id="L652">652</th><td>  func(std::string(it, next));</td></tr><tr><th id="L653">653</th><td>}</td></tr><tr><th id="L654">654</th><td/></tr><tr><th id="L655">655</th><td><b>static</b> std::map&lt;std::string, std::string&gt; <dfn class="fn" sym-ref="4879.split_defines">split_defines</dfn>(<em>const</em> std::string&amp; liststr)</td></tr><tr><th id="L656">656</th><td>{</td></tr><tr><th id="L657">657</th><td>  std::map&lt;std::string, std::string&gt; r;</td></tr><tr><th id="L658">658</th><td/></tr><tr><th id="L659">659</th><td>  <b>auto</b> insert_define = [&amp;r](<a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span> str) {</td></tr><tr><th id="L660">660</th><td>    <b>if</b> (str.<span class="member memfn" sym-ref="1751.empty">empty</span>())</td></tr><tr><th id="L661">661</th><td>      <b>return</b>;</td></tr><tr><th id="L662">662</th><td/></tr><tr><th id="L663">663</th><td>    size_t n = str.<span class="member memfn" sym-ref="1760.find">find</span>(<var>'='</var>);</td></tr><tr><th id="L664">664</th><td/></tr><tr><th id="L665">665</th><td>    <b>if</b> (n == <a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span>::<span class="member staticvar" sym-ref="1761.npos">npos</span>)</td></tr><tr><th id="L666">666</th><td>    {</td></tr><tr><th id="L667">667</th><td>      r[str] = std::string();</td></tr><tr><th id="L668">668</th><td>    }</td></tr><tr><th id="L669">669</th><td>    <b>else</b></td></tr><tr><th id="L670">670</th><td>    {</td></tr><tr><th id="L671">671</th><td>      r[str.substr(<var>0</var>, n)] = str.substr(n + <var>1</var>);</td></tr><tr><th id="L672">672</th><td>    }</td></tr><tr><th id="L673">673</th><td>  };</td></tr><tr><th id="L674">674</th><td/></tr><tr><th id="L675">675</th><td>  <a href="sqlqueries.cpp.html#L640" class="fn" sym-ref="4878.split_apply">split_apply</a>(liststr, <var>';'</var>, insert_define);</td></tr><tr><th id="L676">676</th><td/></tr><tr><th id="L677">677</th><td>  <b>return</b> r;</td></tr><tr><th id="L678">678</th><td>}</td></tr><tr><th id="L679">679</th><td/></tr><tr><th id="L680">680</th><td><b>static</b> std::set&lt;std::string&gt; <dfn class="fn" sym-ref="4880.split_includes">split_includes</dfn>(<em>const</em> std::string&amp; liststr)</td></tr><tr><th id="L681">681</th><td>{</td></tr><tr><th id="L682">682</th><td>  std::set&lt;std::string&gt; r;</td></tr><tr><th id="L683">683</th><td/></tr><tr><th id="L684">684</th><td>  <b>auto</b> insert_if_not_empty = [&amp;r](<a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="type cxxtypealias" sym-ref="32.string">string</span> str) {</td></tr><tr><th id="L685">685</th><td>    <b>if</b> (!str.empty())</td></tr><tr><th id="L686">686</th><td>      r.insert(std::move(str));</td></tr><tr><th id="L687">687</th><td>  };</td></tr><tr><th id="L688">688</th><td/></tr><tr><th id="L689">689</th><td>  <a href="sqlqueries.cpp.html#L640" class="fn" sym-ref="4878.split_apply">split_apply</a>(liststr, <var>';'</var>, insert_if_not_empty);</td></tr><tr><th id="L690">690</th><td/></tr><tr><th id="L691">691</th><td>  <b>return</b> r;</td></tr><tr><th id="L692">692</th><td>}</td></tr><tr><th id="L693">693</th><td/></tr><tr><th id="L694">694</th><td>std::map&lt;<em>int</em>, std::shared_ptr&lt;program::CompileOptions&gt;&gt; <dfn class="fn" sym-ref="4819.select_compileoptions">select_compileoptions</dfn>(Database&amp; db)</td></tr><tr><th id="L695">695</th><td>{</td></tr><tr><th id="L696">696</th><td>  std::map&lt;<em>int</em>, std::shared_ptr&lt;program::CompileOptions&gt;&gt; dict;</td></tr><tr><th id="L697">697</th><td/></tr><tr><th id="L698">698</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"SELECT id, defines, includedirs FROM compileoptions"</var> };</td></tr><tr><th id="L699">699</th><td/></tr><tr><th id="L700">700</th><td>  <b>while</b> (stmt.<a href="../include/csnap/database/sql.h.html#L81" class="member memfn" sym-ref="4785.step">step</a>())</td></tr><tr><th id="L701">701</th><td>  {</td></tr><tr><th id="L702">702</th><td>    <em>int</em> id = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>0</var>);</td></tr><tr><th id="L703">703</th><td>    <b>auto</b> opt = <a href="../../indexer/libclang-utils/include/libclang-utils/clang-cursor.h.html#L526" class="namespace" sym-ref="4.std">std</a>::<span class="fn" sym-ref="1396.make_shared">make_shared</span>&lt;<span class="namespace" sym-ref="4565.program">program</span>::<a href="../../model/include/csnap/model/translationunit.h.html#L22" class="type struct" sym-ref="4566.CompileOptions">CompileOptions</a>&gt;();</td></tr><tr><th id="L704">704</th><td>    opt-&gt;defines = split_defines(stmt.column(<var>1</var>));</td></tr><tr><th id="L705">705</th><td>    opt-&gt;includedirs = split_includes(stmt.column(<var>2</var>));</td></tr><tr><th id="L706">706</th><td/></tr><tr><th id="L707">707</th><td>    dict[id] = opt;</td></tr><tr><th id="L708">708</th><td>  }</td></tr><tr><th id="L709">709</th><td/></tr><tr><th id="L710">710</th><td>  <b>return</b> dict;</td></tr><tr><th id="L711">711</th><td>}</td></tr><tr><th id="L712">712</th><td/></tr><tr><th id="L713">713</th><td>std::vector&lt;TranslationUnit&gt; <dfn class="fn" sym-ref="4820.select_translationunit">select_translationunit</dfn>(Database&amp; db)</td></tr><tr><th id="L714">714</th><td>{</td></tr><tr><th id="L715">715</th><td>  std::map&lt;<em>int</em>, std::shared_ptr&lt;program::CompileOptions&gt;&gt; copts = select_compileoptions(db);</td></tr><tr><th id="L716">716</th><td/></tr><tr><th id="L717">717</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db, <var>"SELECT id, file_id, compileoptions_id FROM translationunit"</var> };</td></tr><tr><th id="L718">718</th><td/></tr><tr><th id="L719">719</th><td>  <b>return</b> <a href="sqlqueries.cpp.html#L144" class="fn" sym-ref="4872.read_vector">read_vector</a>&lt;<a href="../../model/include/csnap/model/translationunit.h.html#L30" class="type struct" sym-ref="4563.TranslationUnit">TranslationUnit</a>&gt;(stmt, [&amp;copts](<span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a>&amp; stmt) {</td></tr><tr><th id="L720">720</th><td>    <a href="../../model/include/csnap/model/translationunit.h.html#L30" class="type struct" sym-ref="4563.TranslationUnit">TranslationUnit</a> tu;</td></tr><tr><th id="L721">721</th><td>    tu.<a href="../../model/include/csnap/model/translationunit.h.html#L32" class="member field" sym-ref="4569.id">id</a> <a href="../../model/include/csnap/model/identifier.h.html#L38" class="member memfn" sym-ref="4527.operator=">=</a> <a href="../../model/include/csnap/model/identifier.h.html#L22" class="member constructor" sym-ref="4524.Identifier<T>">TranslationUnitId</a>(stmt.columnInt(<var>0</var>));</td></tr><tr><th id="L722">722</th><td>    tu.<a href="../../model/include/csnap/model/translationunit.h.html#L33" class="member field" sym-ref="4570.sourcefile_id">sourcefile_id</a> <a href="../../model/include/csnap/model/identifier.h.html#L38" class="member memfn" sym-ref="4527.operator=">=</a> <a href="../../model/include/csnap/model/identifier.h.html#L22" class="member constructor" sym-ref="4524.Identifier<T>">FileId</a>(stmt.columnInt(<var>1</var>));</td></tr><tr><th id="L723">723</th><td>    tu.compile_options = copts[stmt.columnInt(<var>2</var>)];</td></tr><tr><th id="L724">724</th><td>    <b>return</b> tu;</td></tr><tr><th id="L725">725</th><td>    });</td></tr><tr><th id="L726">726</th><td>}</td></tr><tr><th id="L727">727</th><td/></tr><tr><th id="L728">728</th><td><i>/**</i></td></tr><tr><th id="L729">729</th><td><i> * \brief select rows from the include table</i></td></tr><tr><th id="L730">730</th><td><i> * \param file_id           filter with respect to the file_id column</i></td></tr><tr><th id="L731">731</th><td><i> * \param included_file_id  filter with respect to the included_file_id column</i></td></tr><tr><th id="L732">732</th><td><i> * </i></td></tr><tr><th id="L733">733</th><td><i> * You can pass invalid file ids to this function, in which case no filtering will </i></td></tr><tr><th id="L734">734</th><td><i> * be applied to the column.</i></td></tr><tr><th id="L735">735</th><td><i> * </i></td></tr><tr><th id="L736">736</th><td><i> * Example:</i></td></tr><tr><th id="L737">737</th><td><i> * \code{.cpp}</i></td></tr><tr><th id="L738">738</th><td><i> *   // Get all the files included by 'myfile':</i></td></tr><tr><th id="L739">739</th><td><i> *   select_from_include(database, myfile, FileId());</i></td></tr><tr><th id="L740">740</th><td><i> * // Get all the files that include by 'myfile':</i></td></tr><tr><th id="L741">741</th><td><i> *   select_from_include(database, FileId(), myfile)</i></td></tr><tr><th id="L742">742</th><td><i> * \endcode</i></td></tr><tr><th id="L743">743</th><td><i> */</i></td></tr><tr><th id="L744">744</th><td>std::vector&lt;Include&gt; <dfn class="fn" sym-ref="4821.select_from_include">select_from_include</dfn>(Database&amp; db, FileId file_id, FileId included_file_id)</td></tr><tr><th id="L745">745</th><td>{</td></tr><tr><th id="L746">746</th><td>  std::map&lt;<em>int</em>, std::shared_ptr&lt;program::CompileOptions&gt;&gt; copts = select_compileoptions(db);</td></tr><tr><th id="L747">747</th><td/></tr><tr><th id="L748">748</th><td>  <span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a> <a href="../include/csnap/database/sql.h.html#L57" class="member constructor" sym-ref="4780.Statement">stmt</a>{ db,</td></tr><tr><th id="L749">749</th><td>    <var>"SELECT file_id, line, included_file_id FROM include "</var></td></tr><tr><th id="L750">750</th><td>    <var>"WHERE (file_id = ?1 OR ?1 = -1) AND (included_file_id = ?2 OR ?2 = -1)"</var>};</td></tr><tr><th id="L751">751</th><td/></tr><tr><th id="L752">752</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>1</var>, file_id.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>());</td></tr><tr><th id="L753">753</th><td>  stmt.<a href="../include/csnap/database/sql.h.html#L123" class="member memfn" sym-ref="4793.bind">bind</a>(<var>2</var>, included_file_id.<a href="../../model/include/csnap/model/identifier.h.html#L28" class="member memfn" sym-ref="4525.value">value</a>());</td></tr><tr><th id="L754">754</th><td/></tr><tr><th id="L755">755</th><td>  <b>return</b> <a href="sqlqueries.cpp.html#L144" class="fn" sym-ref="4872.read_vector">read_vector</a>&lt;<a href="../../model/include/csnap/model/include.h.html#L16" class="type struct" sym-ref="4559.Include">Include</a>&gt;(stmt, [](<span class="namespace" sym-ref="4774.sql">sql</span>::<a href="../include/csnap/database/sql.h.html#L19" class="type cxxclass" sym-ref="4776.Statement">Statement</a>&amp; stmt) {</td></tr><tr><th id="L756">756</th><td>    <a href="../../model/include/csnap/model/include.h.html#L16" class="type struct" sym-ref="4559.Include">Include</a> r;</td></tr><tr><th id="L757">757</th><td>    r.<a href="../../model/include/csnap/model/include.h.html#L21" class="member field" sym-ref="4560.file_id">file_id</a> <a href="../../model/include/csnap/model/identifier.h.html#L38" class="member memfn" sym-ref="4527.operator=">=</a> <a href="../../model/include/csnap/model/fileid.h.html#L15" class="type cxxtypealias" sym-ref="4533.FileId">FileId</a>(stmt.columnInt(<var>0</var>));</td></tr><tr><th id="L758">758</th><td>    r.<a href="../../model/include/csnap/model/include.h.html#L31" class="member field" sym-ref="4562.line">line</a> = stmt.<a href="../include/csnap/database/sql.h.html#L143" class="member memfn" sym-ref="4797.columnInt">columnInt</a>(<var>1</var>);</td></tr><tr><th id="L759">759</th><td>    r.<a href="../../model/include/csnap/model/include.h.html#L26" class="member field" sym-ref="4561.included_file_id">included_file_id</a> <a href="../../model/include/csnap/model/identifier.h.html#L38" class="member memfn" sym-ref="4527.operator=">=</a> <a href="../../model/include/csnap/model/fileid.h.html#L15" class="type cxxtypealias" sym-ref="4533.FileId">FileId</a>(stmt.columnInt(<var>2</var>));</td></tr><tr><th id="L760">760</th><td>    <b>return</b> r;</td></tr><tr><th id="L761">761</th><td>    });</td></tr><tr><th id="L762">762</th><td>}</td></tr><tr><th id="L763">763</th><td/></tr><tr><th id="L764">764</th><td>} <i>// namespace csnap</i></td></tr></tbody></table></div></body></html>